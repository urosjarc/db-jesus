<h1 align="center">db-messiah</h1>
<h3 align="center">
    Type safe SQL framework for Kotlin, built on top of JDBC and reflection.<br>
    Strong focus on simplicity and minimal developer interference.<br>
</h3>
<p align="center">
    +<b>290</b> <a href="https://github.com/urosjarc/db-messiah/blob/master/src/test">unit</a>,
    +<b>210</b> <a href="https://github.com/urosjarc/db-messiah/blob/master/src/e2e">e2e</a>,
    +<b>30</b> <a href="https://github.com/urosjarc/db-messiah/blob/master/src/main/kotlin/com/urosjarc/dbmessiah/SerializerTests.kt">initialization</a> and
    +<b>22</b> <a href="https://github.com/urosjarc/db-messiah/blob/master/src/tutorials">tutorial</a> tests<br>
    readme code snippets are
    <a href="https://github.com/urosjarc/db-messiah/blob/master/src/tutorials/kotlin/Test_README.md">autogenerated</a>
    and
    <a href="https://github.com/urosjarc/db-messiah/blob/master/src/tutorials/kotlin/Test_README.kt">tested</a><br>
    +<b>86%</b> instruction coverage
</p>

<p align="center">
    Db Messiah scans user provided data classes and all their properties with reflection<br>
    in order to know how to decode user actions like `db.table.create&#60;T&#62;()`<br>
    into prepared SQL statements that are type safe, escaped, and free from SQL injections.
</p>

<p align="center">
    Because everything is scanned with reflection, your data classes will<br>
    directly represent your whole database structure, without the need of any additional work.<br>
    Here is an minimalistic example how would you define database with one table...
</p>

```kotlin
data class TestTable(var id: Int? = null, val column: String)

val db = SqliteService(
    config = Properties().apply { this["jdbcUrl"] = "jdbc:sqlite::memory:" },
    ser = SqliteSerializer(
        tables = listOf(Table(TestTable::id)),
        globalSerializers = BasicTS.sqlite
    )
)
```

<p align="center">
    Db Messiah provides simplistic but feature complete clean syntax for database interactions...
</p>

```kotlin
db.transaction {
    it.table.drop<TestTable>()
    it.table.create<TestTable>()
    it.table.delete<TestTable>()
    it.row.insert(TestTable(column = "col0"))
    it.table.delete<TestTable>()
    // ...
}
```

Because of reflection, it provides very simple solution for writing complex queries.<br> 
There are only 4 methods to be remembered: it.<b>name</b>, it.<b>column</b>, it.<b>table</b>, it.<b>input</b><br>
Thats it! Everything else is joust ordinary SQL syntax that you know and love.<br>
This is an example how the most complex query in db-messiah looks like,
it's basically raw SQL with additional features like type safety and SQL injection .
</p>

```kotlin
val result = it.query.get(output = Out::class, input = parent) {
    """
    SELECT ${it.column(Child::value)}  AS ${it.name(Out::child_value)},
           ${it.column(Parent::value)} AS ${it.name(Out::parent_value)}
    FROM ${it.table<Child>()}
    JOIN ${it.table<Parent>()} ON ${it.column(Parent::pk)} = ${it.column(Child::parent_pk)}
    WHERE ${it.column(Child::value)} = ${it.input(Parent::value)}
    """
}
```

<br>
<br>
<table width="100%" border="0">
    <tr>
        <td width="33%">
            <h3 align="center"><a href="https://github.com/urosjarc/db-messiah-extra">db-messiah-extra</a></h3>
            <p align="center">Extra utils for db-messiah. Support for kotlinx.datetime types, etc... </p>
        </td>
        <td width="33%" align="center">
                <p><a href="#get-started">Get started</a></p>
                <p><a href="#tutorials">Tutorials</a></p>
                <p><a href="#specifications">Specifications</a></p>
                <p><a href="#arhitecture">Arhitecture</a></p>
                <p><a href="https://urosjarc.github.io/db-messiah/">Documentation</a></p>
        </td>
        <td width="33%">
            <h3 align="center"><a href="https://github.com/urosjarc/db-analyser">db-analyser</a></h3>
            <p align="center">GUI for db analysis, to help you create complex JOIN statements for SQL or db-messiah.
        </td>
    </tr>
</table>
<br>
<br>

<h2 align="center">Get started</h2>

```kotlin
/** DEPENDENCIES */

implementation("com.urosjarc:db-messiah:0.0.2") // Required
implementation("com.urosjarc:db-messiah-extra:0.0.2") // Optional
implementation("org.apache.logging.log4j:log4j-slf4j2-impl:2.20.0") //Optional

/** DRIVERS */

runtimeOnly("com.ibm.db2:jcc:11.5.9.0")
runtimeOnly("com.h2database:h2:2.2.224")
runtimeOnly("org.apache.derby:derby:10.17.1.0")
runtimeOnly("org.mariadb.jdbc:mariadb-java-client:3.3.2")
runtimeOnly("org.xerial:sqlite-jdbc:3.44.1.0")
runtimeOnly("com.mysql:mysql-connector-j:8.2.0")
runtimeOnly("com.microsoft.sqlserver:mssql-jdbc:12.4.2.jre11")
runtimeOnly("org.postgresql:postgresql:42.7.1")
runtimeOnly("com.oracle.database.jdbc:ojdbc11:23.3.0.23.09")
```

<br><h3 align="center">Primary keys</h3>

```kotlin
/** TYPE SAFE ID */

@JvmInline
value class Id<T>(val value: Int) {
    /** You must override toString! */
    override fun toString(): String = this.value.toString()
}

/** TYPE SAFE UID */

@JvmInline
value class UId<T>(val value: UUID = UUID.randomUUID()) {
    /** You must override toString! */
    override fun toString(): String = this.value.toString()
}
```

<br><h3 align="center">Domain</h3>

```kotlin
/** PARENT */

data class Parent(
    var pk: Id<Parent>? = null, // INTEGER Auto-incremental primary key
    var value: String           // NOT NULL column
)

/** CHILD */

data class Child(
    val pk: UId<Child> = UId(), // UUID Manual primary key
    val parent_pk: Id<Parent>,  // Foreign key, NOT NULL
    val value: String?          // NULL column
)

/** UNSAFE */

data class Unsafe(
//  var pk: Int? = null,                 // Unsafe INTEGER auto-incremental primary key
    val pk: UUID = UUID.randomUUID(),    // Unsafe UUID manual primary key
    val created: Instant = Instant.now() // Support for java.time.*
)

/** QUERY DTO */

data class Out(val child_value: String, val parent_value: String)
```

<br><h3 align="center">Database</h3>

```kotlin
/** SQLITE */

val sqliteSerializer = SqliteSerializer(
    globalSerializers = BasicTS.sqlite + JavaTimeTS.sqlite + listOf(
        IdTS.int(construct = { Id<Any>(it) }, deconstruct = { it.value }),
        IdTS.uuid.sqlite(construct = { UId<Any>(it) })
    ),
    tables = listOf(
        Table(Unsafe::pk),
        Table(Parent::pk),
        Table(
            primaryKey = Child::pk,
            foreignKeys = listOf(Child::parent_pk to Parent::class),
            constraints = listOf(
                Child::parent_pk to listOf(C.CASCADE_DELETE, C.CASCADE_UPDATE),
                Child::value to listOf(C.UNIQUE)
            )
        ),
    ),
    globalOutputs = listOf(Out::class),
)

/** POSTGRES */

val pgSerializer = PgSerializer(
    globalSerializers = BasicTS.postgresql + JavaTimeTS.postgresql,
    schemas = listOf(
        PgSchema(name = "other", tables = listOf(Table(Unsafe::pk)))
    ),
)

/** CONFIG */

val config = Properties().apply {
    this["jdbcUrl"] = "jdbc:sqlite::memory:"
    this["username"] = "root"
    this["password"] = "root"
}

/** SERVICE */

val sqlite = SqliteService(
    config = config,
    ser = sqliteSerializer
)
```

<br><h3 align="center">Diagrams</h3>

<table width="100%">
<tr>
    <td width="50%" align="center"> <a href="https://plantuml.com/">PlantUML</a> </td>
    <td width="50%" align="center"> <a href="https://dbdiagram.io/home">dbdiagram.io</a> </td>
</tr>
<tr>
<td width="50%">

```kotlin
File("./build/db.pluml")
    .writeText(
        sqliteSerializer.plantUML(
            withOtherColumns = false
        )
    )
```

</td>
<td width="50%">

```kotlin
File("./build/db.txt")
    .writeText(
        sqliteSerializer.dbDiagramIO(
            withOtherColumns = false
        )
    )
```

</td>
</tr>
<tr>
    <td width="50%"> <img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/chinook.plantuml.png"> </td>
    <td width="50%"> <img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/chinook.dbdiagramio.png"> </td>
</tr>
</table>

<br><h3 align="center">Operations</h3>

```kotlin
sqlite.autocommit {

    /** CREATE */

    it.table.create<Parent>()
    it.table.create<Child>()
    it.table.create<Unsafe>()

    /** INSERT */

    val parent = Parent(value = "Hello World!")
    it.row.insert(row = parent)
    assert(parent.pk != null)

    /** BATCH INSERT */

    val children = arrayOfNulls<Child>(3000).mapIndexed { i, _ ->
        Child(pk = UId(), parent_pk = parent.pk!!, value = "value_$i")
    }
    it.batch.insert(rows = children) // INSERT 1000 rows / batch.

    /** SELECT */

    val parents = it.table.select<Parent>()
    assert(parents.contains(parent))

    /** SELECT PAGE */

    val page = it.table.select<Child>(
        page = Page(
            number = 2, limit = 5,
            orderBy = Child::pk,
            order = Order.DESC
        )
    )
    assert(page.size == 5)

    /** SELECT CURSOR */

    val cursor = it.table.select<Child, UId<Child>>(
        cursor = Cursor(
            index = children[3].pk, limit = 5,
            orderBy = Child::pk, order = Order.ASC
        )
    )
    assert(cursor.size == 5)

    /** UPDATE */

    parent.value = "value_3"
    it.row.update(parent)

    /** WHERE */

    val someChildren = it.query.get(output = Child::class, input = parent) {
        """ ${it.SELECT<Child>()} WHERE ${it.column(Child::value)} = ${it.input(Parent::value)} """
    }
    assert(someChildren == listOf(children[3]))

    /** JOIN */

    val moreChildren = it.query.get(output = Child::class, input = parent) {
        """
        ${it.SELECT<Child>()}
        INNER JOIN ${it.table<Parent>()} ON ${it.column(Parent::pk)} = ${it.column(Child::parent_pk)}
        WHERE ${it.column(Child::value)} = ${it.input(Parent::value)}
    """
    }
    assert(moreChildren == listOf(children[3]))

```

<br><h3 align="center">Transactions</h3>

```kotlin
sqlite.transaction { // Any exception inside will trigger rollback ALL!
    //...
    val savePoint = it.roolback.savePoint()
    //...
    it.roolback.to(point = savePoint)
    //...
}

/** ISOLATION */

sqlite.transaction(isolation = Isolation.READ_UNCOMMITTED) {
    //...
}
```

<br><h3 align="center">Serializers</h3>

```kotlin
val DURATION = TypeSerializer(
    kclass = Duration::class,
    dbType = "INTEGER",
    jdbcType = JDBCType.INTEGER,
    decoder = { rs, i, _ -> Duration.ofSeconds(rs.getLong(i)) },
    encoder = { ps, i, x -> ps.setLong(i, x.toSeconds()) }
)

/** REGISTRATION */

SqliteSerializer(
    globalSerializers = BasicTS.sqlite + JavaTimeTS.sqlite + listOf(DURATION),
    tables = listOf(Table(Unsafe::pk))
)
```

<br><h3 align="center">Profiler</h3>

```kotlin
sqlite.autocommit {
    Profiler.active = true

    repeat(10) { _ -> it.table.select<Parent>() }
    repeat(5) { _ -> it.table.select<Child>() }
    repeat(2) { _ -> it.table.select<Unsafe>() }

    Profiler.active = false
}

val profilerLogs = Profiler.logs.values
    .filter { !it.sql.contains("DROP TABLE") }
    .filter { !it.sql.contains("CREATE TABLE") }
    .sortedByDescending { it.duration / it.repetitions }

profilerLogs.forEach {
    println("\n* Query: ${it.sql}")
    println("*    type: ${it.type}")
    println("*    exec: ${it.repetitions}")
    println("*    time: ${it.duration / it.repetitions}")
}

/**
 * Query: SELECT * FROM "main"."Parent"
 *    type: QUERY
 *    exec: 10
 *    time: 285.528us

 * Query: SELECT * FROM "main"."Unsafe"
 *    type: QUERY
 *    exec: 2
 *    time: 65.601us

 * Query: SELECT * FROM "main"."Child"
 *    type: QUERY
 *    exec: 5
 *    time: 40.525us
 */
```

<br> <h3 align="center">Tutorials</h3>

<p align="center">
All tutorials are tested and defined as kotlin files inside <a href="https://github.com/urosjarc/db-messiah/tree/master/src/tutorials/kotlin">src/tutorials/kotlin</a> directory.<br>
Sample project is inside <a href="https://github.com/urosjarc/db-messiah/tree/master/src/chinook/kotlin">src/chinook/kotlin</a> directory and it implements,<br>
for all supported databases, famous <a href="https://github.com/lerocha/chinook-database">Chinook sample database</a>.<br>

</p>

<br> <h3 align="center">Configuration</h3>

<p align="center">
User provided config property object is on initialization, passed directly to the <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> library,
<br>which handles everything around database <a href="https://github.com/brettwooldridge/HikariCP?tab=readme-ov-file#gear-configuration-knobs-baby">connection pooling and configuration</a>.<br>
For customizing SQL generation, see the tutorial for<br>
<a href="https://github.com/urosjarc/db-messiah/blob/master/src/tutorials/kotlin/011_custom_database_serializers.kt">creating custom database serializers</a>.
</p>

<br><h3 align="center">Testing</h3>
<p align="center">Library uses <a href = "https://kotlinlang.org/docs/reflection.html">Kotlin reflection</a> only at initialization, to introspect the user provided db structure.<br>
System will create <a href="https://github.com/urosjarc/db-messiah/blob/master/src/main/kotlin/com/urosjarc/dbmessiah/MapperCache.kt">mapping rules</a> on how kotlin classes will be mapped into db tables.<br>
System will also test resulting rules, in order to find any user errors or inconsistency.<br>
The list of all tests can be found inside <a href="https://github.com/urosjarc/db-messiah/blob/master/src/main/kotlin/com/urosjarc/dbmessiah/SerializerTests.kt">SerializerTests.kt</a>.<br>
System will for E2E testing use db servers defined inside docker <a href="https://github.com/urosjarc/db-messiah/tree/master/compose.yaml">compose.yaml</a> file.<br>
You can start those servers with <code>docker-compose up</code>.

</p>


<br><h3 align="center">Logging</h3>

<p align="center">
The recommend logging configuration is located here <a href="https://github.com/urosjarc/db-messiah/blob/master/src/test/resources/log4j2.xml">src/test/resources/log4j2.xml</a>,<br>
where you can find logger for async rolling log files (one log file per session)<br>
and async console logger with pretty padding for maximum readability.<br>
For detailed explanation read about <a href="https://logging.apache.org/log4j/2.x/manual/appenders.html">Log4j Appenders</a>.
</p>

<br><br><h2 align="center">Specifications</h3>

|          |    Schema    |    Serializer    |    Service    |     Basic types     |   java.time.* types    |
|:--------:|:------------:|:----------------:|:-------------:|:-------------------:|:----------------------:|
|   DB2    |  Db2Schema   |  Db2Serializer   |  Db2Service   |     BasicTS.db2     |     JavaTimeTS.db2     |
|  Derby   | DerbySchema  | DerbySerializer  | DerbyService  |    BasicTS.derby    |    JavaTimeTS.derby    |
|    H2    |   H2Schema   |   H2Serializer   |   H2Service   |     BasicTS.h2      |     JavaTimeTS.h2      |
|  Maria   | MariaSchema  | MariaSerializer  | MariaService  |    BasicTS.maria    |    JavaTimeTS.maria    |
|  MS SQL  | MssqlSchema  | MssqlSerializer  | MssqlService  |    BasicTS.mssql    |    JavaTimeTS.mssql    |
|  MySQL   | MysqlSchema  | MysqlSerializer  | MysqlService  |    BasicTS.mysql    |    JavaTimeTS.mysql    |
|  Oracle  | OracleSchema | OracleSerializer | OracleService |   BasicTS.oracle    |   JavaTimeTS.oracle    |
| Postgres |   PgSchema   |   PgSerializer   |   PgService   | BasicTS. postgresql | JavaTimeTS. postgresql |
|  Sqlite  |     :x:      | SqliteSerializer | SqliteService |   BasicTS.sqlite    |   JavaTimeTS.sqlite    |

<br><h3 align="center">Features</h3>

|          | Escape |         Schema         |    Auto INT PK     |    Auto UUID PK    | UUID column  |    Many queries    |                Cascade                |       Procedure        |
|:--------:|:------:|:----------------------:|:------------------:|:------------------:|:------------:|:------------------:|:-------------------------------------:|:----------------------:|
|   DB2    |  "%s"  | :large_orange_diamond: | :white_check_mark: |        :x:         |   CHAR(36)   |        :x:         |                  :x:                  | :large_orange_diamond: |
|  Derby   |  "%s"  |   :white_check_mark:   | :white_check_mark: |        :x:         |   CHAR(36)   |        :x:         |                  :x:                  |          :x:           |
|    H2    |  "%s"  |   :white_check_mark:   | :white_check_mark: | :white_check_mark: |     UUID     |        :x:         |          :white_check_mark:           |          :x:           |
|  Maria   | \`%s\` |   :white_check_mark:   | :white_check_mark: |        :x:         |     UUID     |        :x:         |                  :x:                  |   :white_check_mark:   |
|  MS SQL  |  [%s]  |   :white_check_mark:   | :white_check_mark: |        :x:         | UNIQUEIDE... | :white_check_mark: |                  :x:                  |   :white_check_mark:   |
|  MySQL   | \`%s\` |   :white_check_mark:   | :white_check_mark: |        :x:         |   CHAR(36)   |        :x:         |                  :x:                  |   :white_check_mark:   |
|  Oracle  |  "%s"  | :large_orange_diamond: | :white_check_mark: |        :x:         | VARCHAR2(36) |        :x:         |          :white_check_mark:           |   :white_check_mark:   |
| Postgres |  "%s"  |   :white_check_mark:   | :white_check_mark: | :white_check_mark: |     UUID     | :white_check_mark: | :white_check_mark: :white_check_mark: |          :x:           |
|  Sqlite  |  "%s"  |          :x:           | :white_check_mark: |        :x:         |   CHAR(36)   |        :x:         |                  :x:                  |          :x:           |

<br><br><h3 align="center">Type system</h3>

|     KClass     |    COLUMN    |              Databases               |       db-messiah        |      db-messiah-extra      |
|:--------------:|:------------:|:------------------------------------:|:-----------------------:|:--------------------------:|
|    Boolean     |     BOOL     |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|      Char      |     CHAR     |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|     String     | VARCHAR(100) |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|     Float      |    FLOAT     |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|     Double     |    DOUBLE    |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|  Byte / UByte  |   TINYINT    |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
| Short / UShort |   SMALLINT   |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|   Int / Uint   |   INTEGER    |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|  Long / ULong  |    BIGINT    |          :white_check_mark:          |   :white_check_mark:    |            :x:             |
|    Instant     |   DATETIME   | Sqlite, Mysql, MSSql, Maria, H2, DB2 | Java :white_check_mark: | kotlinx :white_check_mark: |
|    Instant     |  TIMESTAMP   |       Derby, Postgres, Oracle        | Java :white_check_mark: | kotlinx :white_check_mark: |
| LocalDateTime  |     :x:      |                 :x:                  |        Java :x:         |        kotlinx :x:         |
|   LocalDate    |     DATE     |          :white_check_mark:          | Java :white_check_mark: | kotlinx :white_check_mark: |
|   LocalTime    |     TIME     |    :white_check_mark: but Oracle     | Java :white_check_mark: | kotlinx :white_check_mark: |
|   LocalTime    | NUMBER(5, 0) |                Oracle                | Java :white_check_mark: | kotlinx :white_check_mark: |>

<br><br><h3 align="center">PRIMARY KEY</h3>
<img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/constraints/PRIMARY_KEY.png">

<br><br><h3 align="center">INSERT ROW</h3>
<img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/ROW_INSERT.png">

<br><br><h3 align="center">INSERT BATCH</h3>
<img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/BATCH_INSERT.png">

<br><br><h3 align="center">UPDATE / DELETE</h3>
<table align="center" width="100%">
    <tr>
        <td width="25%" align="center">ROW UPDATE</td>
        <td width="25%" align="center">BATCH UPDATE</td>
        <td width="25%" align="center">ROW DELETE</td>
        <td width="25%" align="center">BATCH DELETE</td>
    </tr>
    <tr>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/ROW_UPDATE.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/BATCH_UPDATE.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/ROW_DELETE.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/queries/BATCH_DELETE.png"></td>
    </tr>
</table>

<br><br><h3 align="center">CONSTRAINTS</h3>
<table align="center" width="100%">
    <tr>
        <td width="25%" align="center">CASCADE DELETE</td>
        <td width="25%" align="center">CASCADE UPDATE</td>
        <td width="25%" align="center">NOT NULL</td>
        <td width="25%" align="center">UNIQUE</td>
    </tr>
    <tr>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/constraints/CASCADE_DELETE.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/constraints/CASCADE_UPDATE.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/constraints/NOT_NULL.png"></td>
        <td width="25%"><img width="100%" src="https://github.com/urosjarc/db-messiah/blob/master/docs/constraints/UNIQUE.png"></td>
    </tr>
</table>

<br><br><h2 align="center">Arhitecture</h3>

```text
src/main/kotlin/com/urosjarc/dbmessiah/
        
|-- builders...........................| Builders to help you build type safe queries.
|   |-- ProcedureBuilder.kt............| Builder for procedures.
|   |-- QueryBuilder.kt................| Builder for custom queries.
|   |-- RowBuilder.kt..................| Builder for creating row queries.
|   `-- SqlBuilder.kt..................| Builder for SQL templates.

it.query.get<Child> { sb: SqlBuilder ->
    """ ${sb.SELECT<Child>()} """
}

|-- ConnectionPool.kt..................| For getting db autocommit or transactional connections.
|-- data...............................| Internal data representations of db elements.
|   |-- BatchQuery.kt
|   |-- Column.kt
|   |-- DbValue.kt
|   |-- DecodeInfo.kt..................| Additional info for Decoder about the decoding value.
|   |-- Decoder.kt.....................| TypeSerializer callback for decoding value.
|   |-- Encoder.kt.....................| TypeSerializer callback for encoding value.
|   |-- ForeignColumn.kt
|   |-- OtherColumn.kt
|   |-- PrimaryColumn.kt
|   |-- ProcedureArg.kt
|   |-- Procedure.kt
|   |-- Query.kt
|   |-- QueryValue.kt
|   |-- TableInfo.kt
|   `-- TypeSerializer.kt..............| Structure that holds information on how some KClass will be mapped to db value.
|-- domain
|   |-- C.kt...........................| All user available constraints, other are inferred with the reflection.
|   |-- Cursor.kt
|   |-- Isolation.kt
|   |-- Order.kt
|   |-- Page.kt
|   |-- QueryLog.kt....................| Log structure used for profiling.
|   |-- Rollback.kt
|   `-- Table.kt
|-- Driver.kt..........................| Driver for preparing and executing Query on JDBC.
|-- exceptions
|   |-- base
|   |   |-- IssueException.kt..........| Exception that needs to be reported on issue tracker.
|   |   |-- UnknownException.kt........| Exception when system does not know if this is an issue or a warning.
|   |   `-- WarningException.kt........| Warning to the user that he did something wrong.
|   |-- ConnectionException.kt
|   |-- DbValueException.kt
|   |-- DriverException.kt
|   |-- MapperException.kt
|   |-- QueryException.kt
|   `-- SerializerTestsException.kt
|-- Exporter.kt........................| Logic for exporting db structure to PlantUML, dbdiagram.io, ...
|-- extend
|   |-- Iterable.kt....................| All extends functions attached to Iterable.
|   |-- KClass.kt......................| All extends functions attached to KClass.
|   `-- KProperty1.kt..................| All extends functions attached to KProperty1.
|-- impl
|   |-- db2
|   |   |-- Db2Schema.kt...............| Structure that will user use to create schema.
|   |   |-- Db2Serializer.kt...........| Serializer for mapping user command to appropriate SQL Query string.
|   |   `-- Db2Service.kt..............| Service for executing user commands on database connection.
|   |-- derby
|   |   |-- DerbySchema.kt
|   |   |-- DerbySerializer.kt
|   |   `-- DerbyService.kt
|   |-- h2
|   |   |-- H2Schema.kt
|   |   |-- H2Serializer.kt
|   |   `-- H2Service.kt
|   |-- maria
|   |   |-- MariaSchema.kt
|   |   |-- MariaSerializer.kt
|   |   `-- MariaService.kt
|   |-- mssql
|   |   |-- MssqlSchema.kt
|   |   |-- MssqlSerializer.kt
|   |   `-- MssqlService.kt
|   |-- mysql
|   |   |-- MysqlSchema.kt
|   |   |-- MysqlSerializer.kt
|   |   `-- MysqlService.kt
|   |-- oracle
|   |   |-- OracleSchema.kt
|   |   |-- OracleSerializer.kt
|   |   `-- OracleService.kt
|   |-- postgresql
|   |   |-- PgSchema.kt
|   |   |-- PgSerializer.kt
|   |   `-- PgService.kt
|   `-- sqlite
|       |-- SqliteSerializer.kt
|       `-- SqliteService.kt
|-- MapperCache.kt.....................| Internal mapping cache containing hashmaps like KClass to TableInfo, KProperty1 to TypeSerializer, etc...
|-- Mapper.kt..........................| User friendly API for MapperCache.
|-- Profiler.kt........................| Simple static class that logs every query executed on Driver.
|-- queries............................| Execution logic for db queries.
|   |-- BatchQueries.kt
|   |-- GetManyQueries.kt..............| Some databases support multiple db calls per query.
|   |-- GetOneQueries.kt...............| For databases that only support one db call per query.
|   |-- NoReturnProcedureQueries.kt
|   |-- ProcedureQueries.kt
|   |-- RowQueries.kt
|   |-- SchemaCascadeQueries.kt........| Some databases support cascading queries on schema. 
|   |-- SchemaQueries.kt...............| For databases that does not support cascading queries.
|   |-- TableCascadeQueries.kt
|   `-- TableQueries.kt
|-- Schema.kt..........................| Interface defining common schema logic.
|-- Serializer.kt......................| Interface defining common serializer logic.
|-- serializers........................| Here are all type serializers (TS) that are supported by the system.
|   |-- BasicTS.kt.....................| User friendly API for accessing all TS for specific database.
|   |-- BooleanTS.kt
|   |-- CharTS.kt
|   |-- DecimalTS.kt
|   |-- IdTS.kt........................| User friendly API for creating custom inline primary key type serializer.
        
IdTS.int(construct = { Id<Any>(it) }, deconstruct = { it.value })
IdTS.uuid.sqlite(construct = { UId<Any>(it) })        
        
|   |-- InstantTS.kt
|   |-- JavaTimeTS.kt..................| User friendly API for accessing all java.time.* supported TS for specific database. 
|   |-- LocalDateTS.kt
|   |-- LocalTimeTS.kt
|   |-- NumberTS.kt
|   |-- StringTS.kt
|   |-- UNumber.kt
|   `-- UUIDTS.kt
|-- SerializerTests.kt.................| Initialization tests for serializer to find any error and inconsistency in user defined db schema.
`-- Service.kt.........................| Interface defining common service logic.
```

<br><br><h2 align="center">Sources</h2>

```text
src/
|-- main...............................| Already described in architecture.
|-- chinook............................| Implementation of chinook sample database for all supported databases.
|   |-- kotlin
|   |   |-- domain
|   |   |   |-- Album.kt
|   |   |   |-- Artist.kt
|   |   |   |-- Customer.kt
|   |   |   |-- Employee.kt
|   |   |   |-- Genre.kt
|   |   |   |-- Invoice.kt
|   |   |   |-- InvoiceLine.kt
|   |   |   |-- MediaType.kt
|   |   |   |-- Playlist.kt
|   |   |   |-- PlaylistTrack.kt
|   |   |   `-- Track.kt
|   |   |-- Id.kt
|   |   |-- Schemas.kt
|   |   |-- Seed.kt....................| INSERT elements to tables.
|   |   |-- Serializers.kt
|   |   |-- Services.kt
|   |   `-- Test_Chinook.kt............| Main testing entry.
|   `-- resources
|       `-- log4j2.xml
|-- e2e
|   |-- kotlin
|   |   |-- domain.kt
|   |   |-- Test_Benchmarks.kt.........| Testing speed of the system.
|   |   |-- Test_Contract.kt...........| Testing interface for all db tests.
|   |   |-- Test_Db2.kt
|   |   |-- Test_Derby.kt
|   |   |-- Test_H2.kt
|   |   |-- Test_Maria.kt
|   |   |-- Test_Mssql.kt
|   |   |-- Test_Mysql.kt
|   |   |-- Test_Oracle.kt
|   |   |-- Test_Postgresql.kt
|   |   `-- Test_Sqlite.kt
|   `-- resources
|       `-- log4j2.xml
|-- test
|   |-- kotlin
|   |   `-- com
|   |       `-- urosjarc
|   |           `-- dbmessiah
|   |               |-- builders
|   |               |   |-- Test_ProcedureBuilder.kt
|   |               |   |-- Test_QueryBuilder.kt
|   |               |   |-- Test_RowBuilder.kt
|   |               |   `-- Test_SqlBuilder.kt
|   |               |-- data
|   |               |   |-- Test_Column.kt
|   |               |   |-- Test_OtherColumn.kt
|   |               |   |-- Test_PrimaryColumn.kt
|   |               |   |-- Test_ProcedureArg.kt
|   |               |   |-- Test_Procedure.kt
|   |               |   `-- Test_Query.kt
|   |               |-- domain
|   |               |   `-- Test_Table.kt
|   |               |-- extend
|   |               |   |-- Test_Iterable.kt
|   |               |   |-- Test_KClass.kt
|   |               |   `-- Test_KProperty.kt
|   |               |-- impl
|   |               |   |-- Test_Db2Serializer.kt
|   |               |   |-- Test_DerbySerializer.kt
|   |               |   |-- Test_H2Serializer.kt
|   |               |   |-- Test_MariaSerializer.kt
|   |               |   |-- Test_MssqlSerializer.kt
|   |               |   |-- Test_MysqlSerializer.kt
|   |               |   |-- Test_OracleSerializer.kt
|   |               |   |-- Test_PgSerializer.kt
|   |               |   `-- Test_SqliteSerializer.kt
|   |               `-- Test_Serializer.kt
|   `-- resources
|       `-- log4j2.xml
`-- tutorials
    |-- kotlin
    |   |-- 000_basic_sqlite.kt
    |   |-- 001_basic_postgresql.kt
    |   |-- 002_query_sqlite.kt
    |   |-- 003_query_postgresql.kt
    |   |-- 004_primary_keys.kt
    |   |-- 005_constraints.kt
    |   |-- 006_transactions.kt
    |   |-- 007_procedures.kt
    |   |-- 008_indexing_and_profiling.kt
    |   |-- 009_exceptions.kt
    |   |-- 010_custom_type_serializers.kt
    |   |-- 011_custom_database_serializers.kt
    |   |-- Test_README.kt...............................| Code from where README.md is generated.
    |   |-- Test_README.md...............................| Template from where README.md is generated.
    |   `-- Test_Tutorials.kt............................| Main testing entry.
    `-- resources
        `-- log4j2.xml
```
